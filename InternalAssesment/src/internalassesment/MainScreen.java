package internalassesment;

import com.formdev.flatlaf.intellijthemes.materialthemeuilite.FlatArcDarkContrastIJTheme;
import java.awt.Color;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import javax.swing.JOptionPane;

/**
 *
 * @author l.mccausland
 */
public class MainScreen extends javax.swing.JFrame {

    //variable to keep count of the quizes
    public int quizCount = 0;
    final String USERNAME = System.getProperty("user.name");
    public final String PATH = "C:\\Users\\" + USERNAME + "\\Downloads\\files\\";
    //public final String PATH = System. getProperty("user. dir");

    /**
     * Creates new form MainScreen
     */
    public MainScreen() {
        initComponents();
        setFrame();
        setList();
        setButtons();
        getFiles();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        quizList = new java.awt.List();
        editButton = new javax.swing.JButton();
        startButton = new javax.swing.JButton();
        createButton = new javax.swing.JButton();
        deleteButton = new javax.swing.JButton();
        refreshButton = new javax.swing.JButton();
        outputLabel = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setBackground(new java.awt.Color(255, 255, 255));

        quizList.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N

        editButton.setText("Edit");
        editButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                editButtonActionPerformed(evt);
            }
        });

        startButton.setText("Start!");
        startButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                startButtonActionPerformed(evt);
            }
        });

        createButton.setText("Create Quiz");
        createButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                createButtonActionPerformed(evt);
            }
        });

        deleteButton.setText("Delete");
        deleteButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deleteButtonActionPerformed(evt);
            }
        });

        refreshButton.setText("Refresh");
        refreshButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                refreshButtonActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Rockwell", 1, 48)); // NOI18N
        jLabel1.setText("Quiza!");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(38, 38, 38)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(createButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(startButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(editButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(deleteButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(57, 57, 57)
                        .addComponent(outputLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 376, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(45, 45, 45)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 175, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(refreshButton, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(quizList, javax.swing.GroupLayout.PREFERRED_SIZE, 376, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(100, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(refreshButton, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(deleteButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(createButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(startButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(editButton))
                    .addComponent(quizList, javax.swing.GroupLayout.PREFERRED_SIZE, 305, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(outputLabel)
                .addContainerGap(55, Short.MAX_VALUE))
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    /**
     * Asks the user to enter the name of the quiz they want to create, then
     * creates it.
     *
     * @param evt
     */
    private void createButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_createButtonActionPerformed
        // Create Input Dialog
        String name = JOptionPane.showInputDialog("Enter quiz name: ");
        if (null == name) {
            JOptionPane.showMessageDialog(null, "enter a name!");
            // if the user adds spaces, tell them to enter something
        } else // if the user enters nothing, tell them to
            switch (name) {
                case "":
                    JOptionPane.showMessageDialog(null, "enter a name!");
                    // if the user enters the name, create the quiz
                    break;
                default:
                    //create a new quiz
                    createQuiz(name);
                    break;
            }
    }//GEN-LAST:event_createButtonActionPerformed
    /**
     * Checks if the "Start!" button was clicked and starts the selected quiz
     *
     * @param evt
     */
    private void startButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_startButtonActionPerformed
        Quiz quiz = QuizManager.getQuiz(quizList.getSelectedIndex());
        if (quiz == null) {
            System.out.println("Null Pointer Exception");
        } else {
            for (int i = 0; i < quiz.questions.size(); i++) {
                System.out.println(quiz.questions.getNode(i));
            }
        }
    }//GEN-LAST:event_startButtonActionPerformed

    /**
     * Checks if the edit button was clicked and edits the selected quiz
     *
     * @param evt
     */
    private void editButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_editButtonActionPerformed
        int index = quizList.getSelectedIndex();
        edit(index);
    }//GEN-LAST:event_editButtonActionPerformed

    /**
     * Checks if the delete button was clicked and then runs the deleteQuiz()
     * method
     *
     * @param evt
     */
    private void deleteButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_deleteButtonActionPerformed
        deleteQuiz();
    }//GEN-LAST:event_deleteButtonActionPerformed
    /**
     * When the refresh button is clicked this method will run the getFiles()
     * method
     *
     * @param evt
     */
    private void refreshButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_refreshButtonActionPerformed
        getFiles();
    }//GEN-LAST:event_refreshButtonActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        try {
            FlatArcDarkContrastIJTheme.setup();
        } catch (Exception e) {
            e.printStackTrace();
        }
        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                new MainScreen().setVisible(true);
            }
        });
    }

    /**
     * sets the visual properties of the JFrame
     */
    private void setFrame() {
        //set window title
        this.setTitle("Quiza");
        //set frame size
        this.setSize(650, 480);
        //set to dispose on close
        this.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        //set location to show up in the middle (null) 
        this.setLocationRelativeTo(null);
        //set background color
        // this.getContentPane().setBackground(new Color(173, 216, 230)); //or whatever color you want in the RGB range
        //set frame visible
        this.setVisible(true);
        //set the frame resizabke property to false
        this.setResizable(false);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton createButton;
    private javax.swing.JButton deleteButton;
    private javax.swing.JButton editButton;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel outputLabel;
    private java.awt.List quizList;
    private javax.swing.JButton refreshButton;
    private javax.swing.JButton startButton;
    // End of variables declaration//GEN-END:variables

    /**
     * Creates a new quiz and adds it to the JList
     *
     * @param name the name the user entered
     */
    private void createQuiz(String name) {
        // adds the quiz to the list
        quizList.add(name);
        quizCount++;
        Quiz newQuiz = new Quiz(name);
        QuizManager.addQuiz(newQuiz, quizCount);

        String path = PATH + name;

        // save quiz to permanent storage
        try {
            FileWriter writer = new FileWriter(path);   // First object
            PrintWriter printer = new PrintWriter(writer);
            printer.print(newQuiz);        // Call class method to write to file   
            printer.close();                                // Close connection
        } catch (IOException error) {                         // catch error....
            output("File write error");        // output message..
        }
        output("Quiz created");
    }

    /**
     * Set AWT List visuals
     */
    private void setList() {
        // set list visuals
        quizList.setBackground(new Color(37, 42, 53));
    }

    /**
     * Set side buttons visual properties
     */
    private void setButtons() {
        // set visuals for buttons 
    }

    private void edit(int index) {
        // Get the quiz that we are working with
        QuizManager manager = new QuizManager();
        Quiz quiz = manager.getQuiz(index);

        // edit quiz questions and properties
        if (quizList.getSelectedItem() == null) {
            output("Select a quiz!");
        } else {
            String length = JOptionPane.showInputDialog(null,
                    "Enter how many questions you want in the quiz: ");
            for (int i = 0; i < Integer.parseInt(length); i++) {
                String newQuestion = JOptionPane.showInputDialog(null, "Enter question " + i + ": ");
                String newAnswer = JOptionPane.showInputDialog(null, "Enter answer to question " + i + ": ");
                quiz.questions.set(i, newQuestion);
                quiz.answers.set(i, newAnswer);

            }
            //addToQuiz();
        }

        // open the quiz and edit the questions
    }

    public void addToQuiz(String item, String text) {
        try {
            File quizToEdit = new File(PATH + item);
            FileWriter writer = new FileWriter(quizToEdit.getPath());
            PrintWriter printer = new PrintWriter(writer);
            printer.print(text + "\n");
            printer.close();
        } catch (IOException e) {
            output("File Write error");
        }
    }

    // WITH ARRAYS
    public void addToQuiz(String item, String[] text) {
        try {
            File quizToEdit = new File(PATH + item);
            FileWriter writer = new FileWriter(quizToEdit.getPath());
            PrintWriter printer = new PrintWriter(writer);
            for (String line : text) {  // Enhanced loop through array..  
                printer.println(line);      // Writing one array index..
            }
            printer.close();
        } catch (IOException e) {
            output("File Write error");
        }
    }

    /**
     * Checks the saved files directory for any already created files. If there
     * is any files that are already present, they are add to the JList for the
     * user.
     */
    private void getFiles() {
        // Clear list
        quizList.removeAll();
        // Get path where already created files are stored
        File folder = new File(PATH);
        // Create a list of files
        File[] listOfFiles = folder.listFiles();
        // Create an array of quizzes to hold the loaded quizzes. Its length is
        // equal to the amount of files detected in the folder
        Quiz[] quizzes = new Quiz[listOfFiles.length];
        // Loop through the listOftFiles and for each file create a new quiz,
        // store it in the quizManager, and add it to the JList with the filename
        for (int i = 0; i < listOfFiles.length; i++) {
            // if the file in spot i is a file then start the try-catch
            if (listOfFiles[i].isFile() && listOfFiles[i].canRead()) {
                try {
                    // In quizzes spot i, create a new Quiz with the found file name
                    quizzes[i] = new Quiz(listOfFiles[i].getName());
                    // Create a new reader with the current file
                    FileReader reader = new FileReader(listOfFiles[i]);
                    // Create buffered reader to read the file
                    BufferedReader buffer = new BufferedReader(reader);

                    // Read a line from the file and store it in a string var
                    String line = buffer.readLine();
                    // Create StringBuilder to combine all the lines of the file
                    StringBuilder builder = new StringBuilder();
                    // While the current line is != to null then add it to the
                    // StringBuilder
                    while (line != null) {
                        //add the current line to the string buidler
                        builder.append(line);
                        // seperate the lines from eachother
                        builder.append(System.lineSeparator());
                        line = buffer.readLine();
                    }
                    // Get all the lines of text from the file with the string builder
                    String text = builder.toString();
                    // Now store the line that was read into the questions array
                    // that is stored inside the quiz that was created 4 lines ago
                    if (text != null) {
                        quizzes[i].questions.set(i, text);
                    }
                    // Close the buffer
                    buffer.close();
                    // Add the quiz to the JList with the file name
                    quizList.add(listOfFiles[i].getName(), i);
                } catch (IOException e) {
                    System.out.println("File write error");
                }
            } else {
                System.out.println("Empty Folder");
            }
            // Make the output blank
            output("");
        }
        // Add the array of quizzes to the quiz manager
        QuizManager.addQuiz(quizzes);
    }

    private void deleteQuiz() {
        if (quizList.getSelectedItem() == null) {
            output("Select a quiz!");
        } else {
            int option = JOptionPane.showConfirmDialog(null, "Are you sure?");
            if (option == 0) {
                String item = quizList.getSelectedItem();
                quizList.remove(item);
                File fileToDelete = new File(PATH + item);
                fileToDelete.delete();
            }
        }
    }

    private void output(String text) {
        outputLabel.setText(text);
    }
}
