package internalassesment;

import com.formdev.flatlaf.intellijthemes.materialthemeuilite.FlatArcDarkContrastIJTheme;
import java.awt.Color;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import javax.swing.JOptionPane;

/**
 *
 * @author l.mccausland
 */
public class MainScreen extends javax.swing.JFrame {

    //variable to keep count of the quizes
    public int quizCount = 0;
    final String USERNAME = System.getProperty("user.name");
    public final String PATH = "C:\\Users\\" + USERNAME + "\\Downloads\\files\\";
    //public final String PATH = System. getProperty("user. dir");

    /**
     * Creates new form MainScreen
     */
    public MainScreen() {
        initComponents();
        setFrame();
        setList();
        setButtons();
        getFiles();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        quizList = new java.awt.List();
        editButton = new javax.swing.JButton();
        startButton = new javax.swing.JButton();
        createButton = new javax.swing.JButton();
        deleteButton = new javax.swing.JButton();
        refreshButton = new javax.swing.JButton();
        outputLabel = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setBackground(new java.awt.Color(255, 255, 255));

        quizList.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N

        editButton.setText("Edit");
        editButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                editButtonActionPerformed(evt);
            }
        });

        startButton.setText("Start!");
        startButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                startButtonActionPerformed(evt);
            }
        });

        createButton.setText("Create Quiz");
        createButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                createButtonActionPerformed(evt);
            }
        });

        deleteButton.setText("Delete");
        deleteButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deleteButtonActionPerformed(evt);
            }
        });

        refreshButton.setText("Refresh");
        refreshButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                refreshButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(38, 38, 38)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(refreshButton, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(createButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(startButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(editButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(deleteButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(57, 57, 57)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(outputLabel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(quizList, javax.swing.GroupLayout.DEFAULT_SIZE, 376, Short.MAX_VALUE))))
                .addContainerGap(100, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(46, 46, 46)
                .addComponent(refreshButton, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(deleteButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(createButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(startButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(editButton))
                    .addComponent(quizList, javax.swing.GroupLayout.PREFERRED_SIZE, 305, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(outputLabel)
                .addContainerGap(56, Short.MAX_VALUE))
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    /**
     * Asks the user to enter the name of the quiz they want to create, then
     * creates it.
     *
     * @param evt
     */
    private void createButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_createButtonActionPerformed
        // Create Input Dialog
        String name = JOptionPane.showInputDialog("Enter quiz name: ");
        if (null == name) {
            JOptionPane.showMessageDialog(null, "enter a name!");
            // if the user adds spaces, tell them to enter something
        } else // if the user enters nothing, tell them to
            switch (name) {
                case "":
                    JOptionPane.showMessageDialog(null, "enter a name!");
                    // if the user enters the name, create the quiz
                    break;
                default:
                    //create a new quiz
                    createQuiz(name);
                    break;
            }
    }//GEN-LAST:event_createButtonActionPerformed
    /**
     * Checks if the "Start!" button was clicked and starts the selected quiz
     *
     * @param evt
     */
    private void startButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_startButtonActionPerformed
        Quiz quiz = QuizManager.getQuiz(quizList.getSelectedIndex());
        System.out.println(quizList.getSelectedIndex());
        System.out.println(quiz.toString());

    }//GEN-LAST:event_startButtonActionPerformed

    /**
     * Checks if the edit button was clicked and edits the selected quiz
     *
     * @param evt
     */
    private void editButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_editButtonActionPerformed
        String item = quizList.getSelectedItem();
        edit(item);
    }//GEN-LAST:event_editButtonActionPerformed

    /**
     * Checks if the delete button was clicked and then runs the deleteQuiz()
     * method
     *
     * @param evt
     */
    private void deleteButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_deleteButtonActionPerformed
        deleteQuiz();
    }//GEN-LAST:event_deleteButtonActionPerformed
    /**
     * When the refresh button is clicked this method will run the getFiles()
     * method
     *
     * @param evt
     */
    private void refreshButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_refreshButtonActionPerformed
        getFiles();
    }//GEN-LAST:event_refreshButtonActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        try {
            FlatArcDarkContrastIJTheme.setup();
        } catch (Exception e) {
            e.printStackTrace();
        }
        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                new MainScreen().setVisible(true);
            }
        });
    }

    /**
     * sets the visual properties of the JFrame
     */
    private void setFrame() {
        //set window title
        this.setTitle("Quiza");
        //set frame size
        this.setSize(650, 480);
        //set to dispose on close
        this.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        //set location to show up in the middle (null) 
        this.setLocationRelativeTo(null);
        //set background color
        // this.getContentPane().setBackground(new Color(173, 216, 230)); //or whatever color you want in the RGB range
        //set frame visible
        this.setVisible(true);
        //set the frame resizabke property to false
        this.setResizable(false);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton createButton;
    private javax.swing.JButton deleteButton;
    private javax.swing.JButton editButton;
    private javax.swing.JLabel outputLabel;
    private java.awt.List quizList;
    private javax.swing.JButton refreshButton;
    private javax.swing.JButton startButton;
    // End of variables declaration//GEN-END:variables

    /**
     * Creates a new quiz and adds it to the JList
     *
     * @param name the name the user entered
     */
    private void createQuiz(String name) {
        // adds the quiz to the list
        quizList.add(name);
        quizCount++;
        Quiz newQuiz = new Quiz(name);
        QuizManager.addQuiz(newQuiz, quizCount);

        String path = PATH + name;

        // save quiz to permanent storage
        try {
            FileWriter writer = new FileWriter(path);   // First object
            PrintWriter printer = new PrintWriter(writer);
            printer.print(newQuiz);        // Call class method to write to file   
            printer.close();                                // Close connection
        } catch (IOException error) {                         // catch error....
            output("File write error");        // output message..
        }
        output("Quiz created");
    }

    /**
     * Set AWT List visuals
     */
    private void setList() {
        // set list visuals
        quizList.setBackground(new Color(37, 42, 53));
    }

    /**
     * Set side buttons visual properties
     */
    private void setButtons() {
        // set visuals for buttons 
    }

    private void edit(String item) {
        // edit quiz questions and properties
        if (item == null) {
            output("Select a quiz!");
        } else {
            String newQuestion = JOptionPane.showInputDialog(null, "Enter a question: ");
            addToQuiz(item, newQuestion);
        }

        // open the quiz and edit the questions
    }

    public void addToQuiz(String item, String text) {
        try {
            File quizToEdit = new File(PATH + item);
            FileWriter writer = new FileWriter(quizToEdit.getPath());
            PrintWriter printer = new PrintWriter(writer);
            printer.print(text + "\n");
            printer.close();
        } catch (IOException e) {
            output("File Write error");
        }
    }

    /**
     * Checks the saved files directory for any already created files. If there
     * is any files that are already present, they are add to the JList for the
     * user.
     */
    private void getFiles() {
        // Clear list
        quizList.removeAll();
        // Get path where already created files are stored
        File folder = new File(PATH);
        // Create a list of files
        File[] listOfFiles = folder.listFiles();
        Quiz[] quizzes = null;
        for (int i = 0; i < listOfFiles.length; i++) {
            if (listOfFiles[i].isFile()) {
                quizzes[i] = new Quiz(listOfFiles[i].getName());
                quizList.add(listOfFiles[i].getName(), i);
            } else {
                System.out.println("Empty Folder");
            }
            output("");
        }
        QuizManager.addQuiz(quizzes);
    }

    private void deleteQuiz() {
        if (quizList.getSelectedItem() == null) {
            output("Select a quiz!");
        } else {
            int option = JOptionPane.showConfirmDialog(null, "Are you sure?");
            if (option == 0) {
                String item = quizList.getSelectedItem();
                quizList.remove(item);
                File fileToDelete = new File(PATH + item);
                fileToDelete.delete();
            }

        }
    }

    private void output(String text) {
        outputLabel.setText(text);
    }
}
